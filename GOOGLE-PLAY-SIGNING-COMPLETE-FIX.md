
# Google Play Signing Key Issue - Complete Fix Guide

## Problem
Your Android App Bundle is signed with the wrong key. Google Play expects:
- **Expected SHA1**: `BD:22:D0:A9:68:F3:1D:A1:A5:C0:88:F4:D3:68:E4:10:98:C9:DE:70`
- **Current SHA1**: `7B:56:B1:F8:CD:12:74:E2:46:B6:7B:DD:33:BB:91:81:92:00:C7:8F`

## Solution Options

### Option 1: Use the Correct Keystore (Recommended)

1. **Locate the Original Keystore**
   - The keystore with SHA1 `BD:22:D0:A9:68:F3:1D:A1:A5:C0:88:F4:D3:68:E4:10:98:C9:DE:70` was used for your first upload
   - Check these locations:
     - `~/.android/` directory
     - Your project root directory
     - Any backup locations
     - Cloud storage (Google Drive, Dropbox, etc.)

2. **Verify the Keystore**
   ```bash
   keytool -list -v -keystore path/to/your-keystore.jks
   ```
   Look for the SHA1 fingerprint matching `BD:22:D0:A9:68:F3:1D:A1:A5:C0:88:F4:D3:68:E4:10:98:C9:DE:70`

3. **Configure EAS Build with Correct Keystore**
   
   Create `credentials.json` in your project root:
   ```json
   {
     "android": {
       "keystore": {
         "keystorePath": "path/to/your-keystore.jks",
         "keystorePassword": "YOUR_KEYSTORE_PASSWORD",
         "keyAlias": "YOUR_KEY_ALIAS",
         "keyPassword": "YOUR_KEY_PASSWORD"
       }
     }
   }
   ```

4. **Build with EAS**
   ```bash
   eas build --platform android --profile production-aab
   ```

### Option 2: Reset Upload Key in Google Play Console

If you cannot find the original keystore, you can reset the upload key:

1. **Go to Google Play Console**
   - Navigate to your app
   - Go to Setup â†’ App signing
   - Click "Request upload key reset"

2. **Follow Google's Process**
   - You'll need to verify your identity
   - Google will provide instructions to generate a new upload key
   - This process can take several days

3. **Generate New Upload Key**
   ```bash
   keytool -genkeypair -v -storetype PKCS12 \
     -keystore upload-keystore.jks \
     -keyalg RSA -keysize 2048 -validity 10000 \
     -alias upload \
     -storepass YOUR_PASSWORD \
     -keypass YOUR_PASSWORD \
     -dname "CN=Your Name, OU=Your Organization, O=Your Company, L=Your City, ST=Your State, C=Your Country Code"
   ```

4. **Extract Certificate**
   ```bash
   keytool -export -rfc -keystore upload-keystore.jks \
     -alias upload -file upload_certificate.pem
   ```

5. **Upload to Google Play Console**
   - Upload the `upload_certificate.pem` file to Google Play Console
   - Wait for approval

### Option 3: Use EAS Build Managed Credentials

Let EAS manage your credentials automatically:

1. **Remove Local Credentials**
   ```bash
   eas credentials
   ```
   Select "Remove credentials" for Android

2. **Build with Auto-Generated Credentials**
   ```bash
   eas build --platform android --profile production-aab
   ```
   EAS will generate new credentials automatically

3. **Download Credentials**
   ```bash
   eas credentials
   ```
   Select "Download credentials" and save them securely

4. **Reset Upload Key in Google Play**
   - Follow Option 2 steps to reset the upload key
   - Use the new credentials generated by EAS

## Important Notes

### Security Best Practices
- **NEVER** commit keystores to version control
- Store keystores in a secure location with backups
- Use strong passwords for keystore and key alias
- Keep credentials in a password manager

### EAS Build Configuration

Your `eas.json` should look like this:

```json
{
  "cli": {
    "version": ">= 5.0.0"
  },
  "build": {
    "production-aab": {
      "android": {
        "buildType": "app-bundle",
        "gradleCommand": ":app:bundleRelease"
      },
      "env": {
        "NODE_ENV": "production"
      }
    }
  }
}
```

### Verification Steps

After building, verify the signature:

```bash
# Extract the certificate from the AAB
jarsigner -verify -verbose -certs app-release.aab

# Or use apksigner
apksigner verify --print-certs app-release.aab
```

## Troubleshooting

### Issue: "Cannot find keystore"
- Ensure the path in `credentials.json` is correct
- Use absolute paths instead of relative paths

### Issue: "Wrong password"
- Double-check keystore password and key password
- They might be different

### Issue: "Key alias not found"
- List all aliases in keystore:
  ```bash
  keytool -list -keystore your-keystore.jks
  ```

### Issue: "Still wrong signature after rebuild"
- Clear EAS build cache:
  ```bash
  eas build --platform android --profile production-aab --clear-cache
  ```

## Prevention for Future

1. **Backup Your Keystore**
   - Store in multiple secure locations
   - Use cloud storage with encryption
   - Keep passwords in a password manager

2. **Document Your Credentials**
   - Keep a record of:
     - Keystore location
     - Keystore password
     - Key alias
     - Key password
     - SHA1 and SHA256 fingerprints

3. **Use EAS Managed Credentials**
   - Let EAS handle credential management
   - Automatic backups and security

## Contact Support

If you're still having issues:
- **Expo Support**: https://expo.dev/support
- **Google Play Support**: https://support.google.com/googleplay/android-developer

## Quick Command Reference

```bash
# List keystore contents
keytool -list -v -keystore your-keystore.jks

# Generate new keystore
keytool -genkeypair -v -storetype PKCS12 -keystore upload-keystore.jks -keyalg RSA -keysize 2048 -validity 10000 -alias upload

# Export certificate
keytool -export -rfc -keystore your-keystore.jks -alias your-alias -file certificate.pem

# Verify AAB signature
jarsigner -verify -verbose -certs app-release.aab

# Build with EAS
eas build --platform android --profile production-aab

# Manage EAS credentials
eas credentials
```

## Summary

The most likely solution is **Option 1** - finding and using the original keystore. If that's not possible, you'll need to go through Google's upload key reset process (**Option 2**).

Remember: The signing key issue is critical for app updates. Without the correct key, you cannot update your existing app listing and would need to create a new app listing (losing all reviews, ratings, and downloads).
